<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>FinTrack</title>
    <link rel="icon" href="/icon.png" type="image/png">
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#ffffff">
    <link rel="apple-touch-icon" href="/icon.png">

    <!-- iOS specific meta tags for better PWA support -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Finance Flow">
    <meta name="apple-touch-startup-image" content="/icon-512x512.png">

    <!-- iOS splash screen for different orientations and sizes -->
    <link rel="apple-touch-startup-image" media="screen and (device-width: 430px) and (device-height: 932px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)" href="/icon-512x512.png">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 393px) and (device-height: 852px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)" href="/icon-512x512.png">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 428px) and (device-height: 926px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)" href="/icon-512x512.png">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)" href="/icon-512x512.png">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)" href="/icon-512x512.png">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="/icon-512x512.png">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="/icon-512x512.png">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)" href="/icon-512x512.png">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="/icon-512x512.png">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)" href="/icon-512x512.png">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 390px) and (device-height: 844px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)" href="/icon-512x512.png">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 428px) and (device-height: 926px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)" href="/icon-512x512.png">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 393px) and (device-height: 852px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)" href="/icon-512x512.png">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 430px) and (device-height: 932px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)" href="/icon-512x512.png">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="/icon-512x512.png">

    <!-- Android/Chrome specific meta tags -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="application-name" content="Finance Flow">
    <meta name="theme-color" content="#f3f4f6" media="(prefers-color-scheme: light)">
    <meta name="theme-color" content="#0f172a" media="(prefers-color-scheme: dark)">
    <meta name="msapplication-TileColor" content="#f3f4f6">
    <meta name="msapplication-config" content="/browserconfig.xml">

    <!-- Prevent zoom on input focus (iOS) and ensure stable mobile layout -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">

    <!-- Format detection -->
    <meta name="format-detection" content="telephone=no">
    <meta name="format-detection" content="date=no">
    <meta name="format-detection" content="address=no">
    <meta name="format-detection" content="email=no">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      :root.theme-light {
        --color-bg-rgb: 243 244 246; /* gray-100 */
        --color-card-rgb: 255 255 255; /* white */
        --color-card-muted-rgb: 249 250 251; /* gray-50 */
        --color-text-rgb: 31 41 55; /* gray-800 */
        --color-text-muted-rgb: 107 114 128; /* gray-500 */
        --color-border-rgb: 229 231 235; /* gray-200 */
        --color-primary-rgb: 37 99 235; /* blue-600 */
        --color-primary-hover-rgb: 29 78 216; /* blue-700 */
        --color-primary-text-rgb: 255 255 255; /* white */
        --color-primary-subtle-text-rgb: 59 130 246; /* blue-500 */
        --gradient-from-rgb: 59 130 246; /* blue-500 */
        --gradient-to-rgb: 29 78 216; /* blue-700 */
      }
      :root.theme-dark-slate {
        --color-bg-rgb: 15 23 42; /* slate-900 */
        --color-card-rgb: 30 41 59; /* slate-800 */
        --color-card-muted-rgb: 51 65 85; /* slate-700 */
        --color-text-rgb: 241 245 249; /* slate-100 */
        --color-text-muted-rgb: 148 163 184; /* slate-400 */
        --color-border-rgb: 51 65 85; /* slate-700 */
        --color-primary-rgb: 59 130 246; /* blue-500 */
        --color-primary-hover-rgb: 37 99 235; /* blue-600 */
        --color-primary-text-rgb: 255 255 255; /* white */
        --color-primary-subtle-text-rgb: 96 165 250; /* blue-400 */
        --gradient-from-rgb: 51 65 85; /* slate-700 */
        --gradient-to-rgb: 30 41 59; /* slate-800 */
      }
      :root.theme-dark-green {
        --color-bg-rgb: 15 23 20; /* green-900 */
        --color-card-rgb: 25 39 30; /* green-800 */
        --color-card-muted-rgb: 34 54 40; /* green-700 */
        --color-text-rgb: 240 253 244; /* green-50 */
        --color-text-muted-rgb: 167 191 174; /* green-400 */
        --color-border-rgb: 52 83 61; /* green-600 */
        --color-primary-rgb: 74 222 128; /* emerald-400 */
        --color-primary-hover-rgb: 52 211 153; /* emerald-500 */
        --color-primary-text-rgb: 15 23 20; /* green-900 */
        --color-primary-subtle-text-rgb: 110 231 183; /* emerald-300 */
        --gradient-from-rgb: 34 54 40; /* green-700 */
        --gradient-to-rgb: 25 39 30; /* green-800 */
      }
      :root.theme-dark-crimson {
        --color-bg-rgb: 28 21 24;
        --color-card-rgb: 49 33 38;
        --color-card-muted-rgb: 68 46 54;
        --color-text-rgb: 255 229 237;
        --color-text-muted-rgb: 209 174 183;
        --color-border-rgb: 92 63 71;
        --color-primary-rgb: 244 63 94; /* rose-500 */
        --color-primary-hover-rgb: 225 29 72; /* rose-600 */
        --color-primary-text-rgb: 255 255 255;
        --color-primary-subtle-text-rgb: 251 113 133; /* rose-400 */
        --gradient-from-rgb: 68 46 54;
        --gradient-to-rgb: 49 33 38;
      }
      body {
        background-color: rgb(var(--color-bg-rgb));
        background-image: radial-gradient(rgb(var(--color-border-rgb)) 0.5px, transparent 0.5px);
        background-size: 20px 20px;
      }
      #initial-loader {
        position: fixed;
        inset: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        background-color: rgb(var(--color-bg-rgb));
        transition: opacity 0.5s;
        z-index: 9999;
      }
      .pulsating-icon {
        animation: pulsate 2s ease-in-out infinite;
      }
      @keyframes pulsate {
        0%, 100% { transform: scale(1); opacity: 1; }
        50% { transform: scale(1.1); opacity: 0.8; }
      }
      /* General Animation */
      @keyframes fadeInUp {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
      }
      .animate-fade-in-up {
        animation: fadeInUp 0.5s ease-out forwards;
      }
      /* Modal Animation */
      .modal-fade-in {
        animation: fadeIn 0.3s ease-out forwards;
      }
      .modal-content-slide-up {
        animation: fadeInUp 0.3s ease-out forwards;
      }
      .animate-slide-in-from-bottom {
        animation: slideInFromBottom 0.3s ease-out forwards;
      }
      .animate-zoom-in {
        animation: zoomIn 0.3s ease-out forwards;
      }
      @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
      }
      @keyframes slideInFromBottom {
        from {
          opacity: 0;
          transform: translateY(100%) scale(0.95);
        }
        to {
          opacity: 1;
          transform: translateY(0) scale(1);
        }
      }
      @keyframes zoomIn {
        from {
          opacity: 0;
          transform: scale(0.9);
        }
        to {
          opacity: 1;
          transform: scale(1);
        }
      }
       /* Balance Card Flip Animation */
      .card-flip-container {
        perspective: 1000px;
      }
      .card-flipper {
        position: relative;
        transform-style: preserve-3d;
        transition: transform 0.6s;
      }
      .card-flipper.flipped {
        transform: rotateY(180deg);
      }
      .card-front, .card-back {
        position: absolute;
        width: 100%;
        height: 100%;
        backface-visibility: hidden;
        -webkit-backface-visibility: hidden;
        border-radius: 1rem; /* 16px */
      }
      .card-back {
        transform: rotateY(180deg);
      }
      /* Sticky Header for Transaction List */
      .sticky-header {
        position: sticky;
        top: 0;
        z-index: 5;
      }

      /* Mobile Layout Fixes */
      html, body {
        height: 100%;
        overflow-x: hidden;
        -webkit-text-size-adjust: 100%;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
      }

      /* Prevent mobile viewport jumping */
      #root {
        min-height: 100vh;
        min-height: 100dvh; /* Dynamic viewport height for mobile */
        display: flex;
        flex-direction: column;
      }

      /* Ensure proper mobile safe areas */
      .mobile-safe-area {
        padding-left: env(safe-area-inset-left);
        padding-right: env(safe-area-inset-right);
        padding-bottom: env(safe-area-inset-bottom);
      }

      /* Fix for iOS Safari bottom bar */
      .mobile-bottom-nav {
        padding-bottom: calc(120px + env(safe-area-inset-bottom));
        min-height: 100vh;
        min-height: 100dvh;
      }

      /* Additional mobile layout fixes */
      @media (max-width: 935px) {
        .mobile-content {
          padding-bottom: 160px; /* Extra padding for bottom nav */
        }

        .mobile-safe-bottom {
          padding-bottom: env(safe-area-inset-bottom);
        }
      }

      /* Prevent horizontal scroll */
      * {
        box-sizing: border-box;
      }

      /* Mobile-specific font size adjustments */
      @media (max-width: 768px) {
        html {
          font-size: 16px;
        }
      }

      /* Improve mobile input handling */
      input, select, textarea {
        font-size: 16px; /* Prevents zoom on iOS */
      }

      /* Better mobile touch targets */
      button, a, [role="button"], [tabindex]:not([tabindex="-1"]) {
        min-height: 44px;
        min-width: 44px;
      }

      /* Improve mobile scrolling */
      body {
        -webkit-overflow-scrolling: touch;
        overscroll-behavior: contain;
      }

      /* Better mobile form styling */
      @media (max-width: 768px) {
        .form-field-spacing {
          margin-bottom: 1.5rem;
        }
        .modal-form {
          padding: 1rem;
        }
      }

      /* Mobile typography improvements */
      @media (max-width: 768px) {
        h1 { font-size: 1.5rem; line-height: 2rem; }
        h2 { font-size: 1.25rem; line-height: 1.75rem; }
        h3 { font-size: 1.125rem; line-height: 1.75rem; }

        .text-xs { font-size: 0.875rem; line-height: 1.25rem; }
        .text-sm { font-size: 1rem; line-height: 1.5rem; }
        .text-base { font-size: 1.125rem; line-height: 1.75rem; }

        /* Better mobile spacing */
        .mobile-spacing-y > * + * { margin-top: 1rem; }
        .mobile-spacing-x > * + * { margin-left: 0.75rem; }
      }

      /* Improved mobile readability */
      @media (max-width: 768px) {
        body {
          line-height: 1.6;
          letter-spacing: 0.01em;
        }

        p, li {
          line-height: 1.7;
        }
      }
    </style>
    <script>
       // This script prevents FOUC (Flash of Unstyled Content) by applying the theme before React loads.
       const theme = localStorage.getItem('financeFlowTheme');
       if (theme) {
         document.documentElement.className = theme;
       } else {
         const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches;
         document.documentElement.className = isDarkMode ? 'theme-dark-slate' : 'theme-light';
       }

       // iOS Safari offline detection and fallback
       if (!navigator.onLine && 'serviceWorker' in navigator) {
         // Check if we can load the main app, if not, redirect to offline page
         setTimeout(() => {
           if (document.querySelector('#root').innerHTML === '') {
             window.location.href = '/offline.html';
           }
         }, 3000);
       }
     </script>
    <script type="importmap">
{
  "imports": {
    "react": "https://aistudiocdn.com/react@^19.2.0",
    "react-dom/": "https://aistudiocdn.com/react-dom@^19.2.0/",
    "react/": "https://aistudiocdn.com/react@^19.2.0/",
    "uuid": "https://aistudiocdn.com/uuid@^13.0.0",
    "recharts": "https://aistudiocdn.com/recharts@^2.12.7",
    "@google/genai": "https://aistudiocdn.com/@google/genai-sdk@^0.20.0"
  }
}
</script>
  <link rel="stylesheet" href="/index.css">
</head>
  <body>
    <div id="root">
      <div id="initial-loader">
        <div class="relative flex items-center justify-center">
          <div class="absolute h-24 w-24 rounded-full bg-green-500/20 animate-ping"></div>
          <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 text-green-500 pulsating-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
            <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 18L9 11.25l4.306 4.307a11.95 11.95 0 015.814-5.519l2.74-1.22m0 0l-5.94-2.28m5.94 2.28l-2.28 5.941" />
          </svg>
        </div>
      </div>
    </div>
    <script type="module" src="/index.tsx"></script>
  </body>
</html>